{
  "name": "x",
  "nodes": [
    {
      "parameters": {
        "formTitle": "Gaming News Generator",
        "formDescription": "Generate a Danish gaming news article. Results will be emailed to you.",
        "formFields": {
          "values": [
            {
              "fieldName": "gameName",
              "fieldLabel": "Game Name",
              "placeholder": "Enter the name of the game you want to create news about",
              "requiredField": true
            },
            {
              "fieldName": "userEmail",
              "fieldLabel": "Your Email",
              "placeholder": "Enter your email to receive the article",
              "requiredField": true
            }
          ]
        },
        "options": {
          "appendAttribution": false,
          "buttonLabel": "Generate Article",
          "formSubmittedText": "✅ Article is being generated! Check your email in 1-2 minutes."
        }
      },
      "id": "5e2c3beb-09bb-4fbf-8276-71cae524261a",
      "name": "Game Selection Form",
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.4,
      "position": [
        -976,
        912
      ],
      "webhookId": "8aabae99-dcb7-461c-b0a1-510c217d823d"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "gameName",
              "value": "={{ $json.gameName }}",
              "type": "string"
            },
            {
              "id": "id-2",
              "name": "maxArticleLength",
              "value": 1500,
              "type": "number"
            },
            {
              "id": "id-2b",
              "name": "minArticleLength",
              "value": 1000,
              "type": "number"
            },
            {
              "id": "id-3",
              "name": "seoMinScore",
              "value": 80,
              "type": "number"
            },
            {
              "id": "id-3b",
              "name": "seoCriticalThreshold",
              "value": 60,
              "type": "number"
            },
            {
              "id": "id-4",
              "name": "maxRevisions",
              "value": 2,
              "type": "number"
            },
            {
              "id": "id-4b",
              "name": "qualityMinScore",
              "value": 75,
              "type": "number"
            },
            {
              "id": "id-4c",
              "name": "qualityCriticalThreshold",
              "value": 70,
              "type": "number"
            },
            {
              "id": "id-5",
              "name": "currentRevision",
              "value": 0,
              "type": "number"
            },
            {
              "id": "id-5b",
              "name": "imageRequired",
              "value": false,
              "type": "boolean"
            },
            {
              "id": "id-5c",
              "name": "maxExecutionTimeMinutes",
              "value": 10,
              "type": "number"
            },
            {
              "id": "id-5d",
              "name": "workflowStartTime",
              "value": "={{ Date.now() }}",
              "type": "number"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "a40f6122-7b0f-4a96-98c8-99d02b3d04df",
      "name": "Workflow Configuration",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -752,
        912
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are a gaming news researcher for an automated gaming magazine.\n\nToday's date is: {{ $now.toISODate() }}\n7 days ago was: {{ $now.minus({ days: 7 }).toISODate() }}\n\nYour goal: Find the BEST and MOST RECENT news about {{ $json.gameName }} focusing on angle: **{{ $json.angle }}**.\n\nOPTIMIZED SEARCH STRATEGY (Efficient Two-Phase Approach):\n\nPHASE 1 - Combined Recent News Search:\n1. Use ONE targeted search combining date and angle: \"{{ $json.gameName }} {{ $json.angle }} {{ $now.toFormat('MMMM yyyy') }} news\"\n2. Check publish dates - prefer articles from last 7 days\n3. If you find recent news (within 7 days), use it and set isRecentNews to true\n\nPHASE 2 - Fallback to Most Recent (Only if Phase 1 fails):\n1. If NO news found in last 7 days, use ONE search: \"{{ $json.gameName }} {{ $json.angle }} latest news\"\n2. Find the MOST RECENT article available (even if older than 7 days)\n3. Prefer news from last 30 days, but accept up to 90 days if that's the most recent\n4. Set isRecentNews to false and include the actual publishDate\n\nCRITICAL - Image Search (Efficient & Direct URLs Only):\n- Use ONE combined image search: \"{{ $json.gameName }} official press kit images\" OR \"{{ $json.gameName }} official artwork steam epic games\"\n- STRICT VALIDATION REQUIRED - Image URLs must pass ALL these checks:\n  1. Must start with https:// or http://\n  2. Must end with .jpg, .jpeg, .png, .webp, .gif, .svg (before any query params)\n  3. Must NOT contain spaces, newlines, or invalid characters\n  4. Must be from trusted domains: steamcdn.com, images.unsplash.com, imgur.com, redd.it, or official game sites\n  5. Must NOT be page URLs (.html, .php, .aspx)\n  6. Must NOT be from: serpapi.com, googleusercontent.com/imgres, cdn2.unrealengine.com\n  7. Path must look like an image path (not /page/, /article/, /news/, /api/, /embed/)\n- DO NOT use SerpAPI image URLs (they expire and show Access Denied)\n- DO NOT use page URLs - ONLY use DIRECT image URLs\n- Find images from: Official game websites, Epic Games Store, Steam CDN, official social media, press release sites\n- Examples of GOOD URLs: https://steamcdn-a.akamaihd.net/steam/apps/123456/header.jpg, https://images.unsplash.com/photo-123456.jpg\n- Examples of BAD URLs: https://example.com/article.html (page), https://serpapi.com/image.jpg (expires), https://cdn2.unrealengine.com/image.jpg (Access Denied), https://example.com/page/image (no extension)\n- imageUrl: Featured image for article header (best quality, most relevant, MUST be valid)\n- contentImageUrl: Optional different image for mid-article use (if available, should be different from imageUrl, MUST be valid)\n- If you can't find VALID direct public image URLs that pass all validation checks, leave them EMPTY (don't use invalid URLs)\n\nEFFICIENCY RULES:\n- Use MAXIMUM 3 searches total: 1 for news, 1 fallback if needed, 1 for images\n- Combine search terms when possible (e.g., \"game name angle date\" instead of separate searches)\n- ALWAYS find SOMETHING - never return NO_RECENT_NEWS_FOUND\n- Prefer official sources (developer/publisher) and reputable gaming/esports sites\n- Verify publish dates accurately\n- Choose the MOST RELEVANT and RECENT news available\n\nReturn structured data:\n- headline (string) - the news headline (always provide one)\n- source (string) - source website name\n- url (string) - direct link to the article\n- publishDate (string, YYYY-MM-DD) - actual verified publish date\n- isRecentNews (boolean) - true if within last 7 days, false if older\n- summary (2–4 sentences) - news summary\n- keyPoints (5–8 bullet points as array) - key details\n- imageUrl (string) - Featured image URL for article header (PUBLICLY accessible, or empty)\n- contentImageUrl (string) - Optional different image for mid-article use (different from imageUrl if possible, or empty)",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are a gaming news research assistant for an automated gaming magazine. Your job is to ALWAYS find relevant news efficiently.\n\nOPTIMIZED TWO-PHASE APPROACH (Use MAX 3 searches total):\n\nPHASE 1 - Combined Recent News Search:\n- Use ONE targeted search: \"game name angle date\" (e.g., \"Fortnite LEGO December 2024 news\")\n- Verify publish dates accurately\n- If found within 7 days, set isRecentNews to true\n\nPHASE 2 - Fallback (Only if Phase 1 fails):\n- Use ONE search: \"game name angle latest news\"\n- Accept news from last 30 days (preferred), up to 90 days if that's all available\n- Set isRecentNews to false\n- ALWAYS find something - never return empty\n\nEFFICIENT Image Search (Use MAX 1 search):\n- Use ONE combined search: \"game name official press kit images\" OR \"game name official artwork steam epic\"\n- STRICT VALIDATION - Image URLs must:\n  1. Start with https:// or http://\n  2. End with .jpg, .jpeg, .png, .webp, .gif, .svg (before query params)\n  3. Have no spaces/newlines/invalid chars\n  4. Be from trusted domains: steamcdn.com, images.unsplash.com, imgur.com, redd.it, or official game sites\n  5. NOT be page URLs (.html, .php, .aspx)\n  6. NOT be from: serpapi.com, googleusercontent.com/imgres, cdn2.unrealengine.com\n  7. Have image-like path (not /page/, /article/, /api/, /embed/)\n- DO NOT use SerpAPI image URLs (they expire)\n- DO NOT use page URLs (ending in .html, .php, or no extension)\n- DO NOT use cdn2.unrealengine.com URLs (they return Access Denied errors)\n- MUST be from publicly accessible CDNs: steamcdn.com, images.unsplash.com, imgur.com, redd.it, official game sites\n- imageUrl: Best featured image for header (most relevant, highest quality, MUST be valid)\n- contentImageUrl: Optional different image for mid-article (different from imageUrl if possible, MUST be valid)\n- Examples: https://steamcdn-a.akamaihd.net/steam/apps/123456/header.jpg (GOOD), https://example.com/article.html (BAD - page), https://cdn2.unrealengine.com/image.jpg (BAD - Access Denied)\n- If no VALID direct public image URLs found that pass all checks, leave both empty\n\nEFFICIENCY: Maximum 3 searches total (1 news, 1 fallback if needed, 1 images). Combine terms when possible.\n\nPreferred sources: Official game websites, IGN, GameSpot, Polygon, Kotaku, PC Gamer, Eurogamer\n\nReturn:\n- headline: News headline (ALWAYS provide one)\n- source: Website name\n- url: Direct article link\n- publishDate: YYYY-MM-DD format (actual verified date)\n- isRecentNews: true if within 7 days, false if older\n- summary: 2-3 sentence summary\n- keyPoints: Array of key points\n- imageUrl: Featured image URL (or empty)\n- contentImageUrl: Optional different image for content (or empty)"
        }
      },
      "id": "3b4c3f20-9c69-49f3-ba57-be1cbbbbb537",
      "name": "Research Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -256,
        912
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {
          "temperature": 0.2
        }
      },
      "id": "bb4666fc-2a89-4c7f-b903-69d826549c80",
      "name": "OpenAI Model - Research",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -304,
        1136
      ],
      "credentials": {
        "openAiApi": {
          "id": "5HFbmVROuozdyQ0Q",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "7211c40d-bbb2-4066-b590-d1a15e346515",
      "name": "Google Search Tool",
      "type": "@n8n/n8n-nodes-langchain.toolSerpApi",
      "typeVersion": 1,
      "position": [
        -176,
        1136
      ],
      "credentials": {
        "serpApi": {
          "id": "72jc39q47o4kOZla",
          "name": "SerpAPI account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"headline\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Main news headline\"\n\t\t},\n\t\t\"source\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"News source\"\n\t\t},\n\t\t\"summary\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Brief summary of the news\"\n\t\t},\n\t\t\"publishDate\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Publication date YYYY-MM-DD\"\n\t\t},\n\t\t\"isRecentNews\": {\n\t\t\t\"type\": \"boolean\",\n\t\t\t\"description\": \"True if news is from last 7 days, false if older\"\n\t\t},\n\t\t\"keyPoints\": {\n\t\t\t\"type\": \"array\",\n\t\t\t\"items\": {\n\t\t\t\t\"type\": \"string\"\n\t\t\t},\n\t\t\t\"description\": \"Key points from the article\"\n\t\t},\n\t\t\"url\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Direct link to the news source\"\n\t\t},\n\t\t\"imageUrl\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"URL to a high-quality featured image for the article header (jpg, png, webp)\"\n\t\t},\n\t\t\"contentImageUrl\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Optional: Different image URL for mid-article use (should be different from imageUrl if possible)\"\n\t\t}\n\t}\n}"
      },
      "id": "90a22376-657f-4329-bb5e-97f6926e2233",
      "name": "Research Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -48,
        1136
      ]
    },
    {
      "parameters": {
        "jsCode": "// Image URL Validator - Comprehensive validation for image URLs\n// Matches frontend isValidImageUrl() logic\n\nconst data = $input.item.json;\nconst imageUrl = data.imageUrl || data.output?.imageUrl || '';\nconst contentImageUrl = data.contentImageUrl || data.output?.contentImageUrl || '';\n\nfunction isValidImageUrl(url) {\n  if (!url || typeof url !== 'string') return false;\n  \n  // Trim and check minimum length\n  url = url.trim();\n  if (url.length < 10 || url.length > 2048) return false;\n  \n  // Must start with http:// or https://\n  if (!/^https?:\\/\\//i.test(url)) return false;\n  \n  // Check for invalid characters (spaces, newlines, etc.)\n  if (/[\\s\\n\\r\\x00]/.test(url)) return false;\n  \n  // Try to parse as URL to validate structure\n  try {\n    const urlObj = new URL(url);\n    \n    // Must have valid hostname\n    if (!urlObj.hostname || urlObj.hostname.length < 3) return false;\n    \n    // Reject localhost and private IPs\n    if (/^(localhost|127\\.|192\\.168\\.|10\\.|172\\.(1[6-9]|2[0-9]|3[01])\\.)/i.test(urlObj.hostname)) return false;\n    \n    // Check path - must look like an image path\n    const path = urlObj.pathname.toLowerCase();\n    \n    // Must have image extension in path (before query params)\n    const hasImageExtension = /\\.(jpg|jpeg|png|webp|gif|svg)(\\?|$|#)/i.test(path);\n    \n    // Check if it's from a trusted CDN or domain\n    const trustedDomains = [\n      'steamcdn-a.akamaihd.net',\n      'steamcdn-a.akamaihd.net',\n      'images.unsplash.com',\n      'cdn.cloudflare.com',\n      'i.imgur.com',\n      'i.redd.it',\n      'media.steampowered.com',\n      'cdn.akamai.steamstatic.com',\n    ];\n    \n    const isFromTrustedDomain = trustedDomains.some(domain => urlObj.hostname.includes(domain));\n    \n    // Reject common non-image URLs and inaccessible domains\n    const rejectedPatterns = [\n      /serpapi\\.com/i,\n      /googleusercontent\\.com\\/imgres/i,\n      /\\.html/i,\n      /\\.php/i,\n      /\\.aspx/i,\n      /\\/page\\//i,\n      /\\/article\\//i,\n      /\\/news\\//i,\n      /cdn2\\.unrealengine\\.com/i, // These URLs return Access Denied\n      /epicgames\\.com\\/[^/]*\\.(html|php|aspx)/i, // Epic Games pages, not images\n      /\\/thumb\\//i, // Thumbnail pages\n      /\\/preview\\//i, // Preview pages\n      /\\?.*format=/i, // Query params suggesting it's a page\n    ];\n    \n    const isRejected = rejectedPatterns.some(pattern => pattern.test(url));\n    \n    // Check for suspicious patterns in path\n    const suspiciousPathPatterns = [\n      /\\/api\\//i,\n      /\\/embed\\//i,\n      /\\/redirect\\//i,\n      /\\/proxy\\//i,\n    ];\n    \n    const hasSuspiciousPath = suspiciousPathPatterns.some(pattern => pattern.test(path));\n    \n    // Path should contain image-like segments (not just / or /page)\n    const hasImageLikePath = path.length > 1 && !/^\\/(page|article|news|home|index)/i.test(path);\n    \n    // Final validation:\n    // 1. Must have image extension OR be from trusted domain\n    // 2. Must not be rejected\n    // 3. Must not have suspicious path\n    // 4. Must have image-like path structure\n    const isValid = (hasImageExtension || isFromTrustedDomain) && \n                    !isRejected && \n                    !hasSuspiciousPath && \n                    hasImageLikePath;\n    \n    return isValid;\n  } catch (e) {\n    // URL parsing failed - invalid URL\n    return false;\n  }\n}\n\n// Validate both image URLs\nconst isValidFeatured = isValidImageUrl(imageUrl);\nconst validatedImageUrl = isValidFeatured ? imageUrl.trim() : '';\n\n// Validate content image - ensure it's different from featured image\nconst isValidContent = isValidImageUrl(contentImageUrl);\nlet validatedContentImageUrl = isValidContent ? contentImageUrl.trim() : '';\n\n// If content image is same as featured image, clear it (we don't want duplicates)\nif (validatedContentImageUrl && validatedContentImageUrl === validatedImageUrl) {\n  validatedContentImageUrl = '';\n}\n\n// Return all data with validated image URLs\nreturn {\n  ...data,\n  imageUrl: validatedImageUrl,\n  contentImageUrl: validatedContentImageUrl,\n  imageUrlValidated: isValidFeatured,\n  contentImageUrlValidated: isValidContent && validatedContentImageUrl !== '',\n  imageUrlOriginal: imageUrl,\n  contentImageUrlOriginal: contentImageUrl,\n  // Preserve output structure if it exists\n  output: data.output ? {\n    ...data.output,\n    imageUrl: validatedImageUrl,\n    contentImageUrl: validatedContentImageUrl\n  } : undefined\n};"
      },
      "id": "image-validator-001",
      "name": "Image URL Validator",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        912
      ]
    },
    {
      "parameters": {
        "jsCode": "// Research Quality Check - Validate research output completeness\nconst data = $input.item.json;\nconst headline = data.headline ?? data.output?.headline ?? '';\nconst keyPoints = data.keyPoints ?? data.output?.keyPoints ?? [];\nconst summary = data.summary ?? data.output?.summary ?? '';\nconst url = data.url ?? data.output?.url ?? '';\n\n// Check if research is complete and usable\nconst hasHeadline = headline && headline.trim().length > 0;\nconst hasKeyPoints = Array.isArray(keyPoints) && keyPoints.length >= 3;\nconst hasSummary = summary && summary.trim().length > 20;\nconst hasUrl = url && url.trim().length > 0;\n\nconst researchQuality = {\n  isComplete: hasHeadline && hasKeyPoints && hasSummary && hasUrl,\n  missingFields: [\n    !hasHeadline && 'headline',\n    !hasKeyPoints && 'keyPoints',\n    !hasSummary && 'summary',\n    !hasUrl && 'url'\n  ].filter(Boolean),\n  qualityScore: (\n    (hasHeadline ? 25 : 0) +\n    (hasKeyPoints ? 25 : 0) +\n    (hasSummary ? 25 : 0) +\n    (hasUrl ? 25 : 0)\n  )\n};\n\nreturn {\n  ...data,\n  researchQuality: researchQuality,\n  // If research is incomplete, flag it but don't fail - let writer handle it\n  researchValid: researchQuality.qualityScore >= 75\n};"
      },
      "id": "research-quality-check-001",
      "name": "Research Quality Check",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -128,
        912
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Extract SEO keywords for a Danish gaming article about:\n\nGame: {{ $json.gameName }}\nAngle: {{ $json.angle }}\nNews: {{ $json.headline ?? $json.output.headline }}\n\nYour task: Identify 5-10 relevant SEO keywords (in Danish) that should be naturally integrated into the article for optimal search engine optimization.\n\nConsider:\n- Game name variations\n- Genre terms (e.g., \"Battle Royale\", \"RPG\", \"FPS\")\n- Platform terms (e.g., \"PC\", \"Mobile\", \"Console\")\n- Topic keywords related to the angle (e.g., \"Opdatering\", \"Esports\", \"Nyheder\")\n- Long-tail keywords Danish gamers might search for\n- Related gaming terms\n\nReturn structured data with:\n- primaryKeywords: Array of 3-5 main keywords (must include game name)\n- secondaryKeywords: Array of 3-5 supporting keywords\n- longTailKeywords: Array of 2-3 long-tail keyword phrases\n- keywordDensityTarget: Suggested keyword density percentage (1-2% for game name)",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an SEO keyword research specialist for Danish gaming content. Extract relevant keywords that will help the article rank well in Danish search results.\n\nFocus on:\n1. Primary keywords: Game name + main topic (e.g., \"Fortnite opdatering\", \"Call of Duty esports\")\n2. Secondary keywords: Related terms, genre, platform\n3. Long-tail keywords: Specific search phrases Danish gamers use\n\nAll keywords should be in Danish and relevant to the gaming news angle.\n\nReturn:\n- primaryKeywords: 3-5 main keywords including game name\n- secondaryKeywords: 3-5 supporting keywords\n- longTailKeywords: 2-3 long-tail phrases\n- keywordDensityTarget: 1-2% for game name"
        }
      },
      "id": "keyword-research-001",
      "name": "Keyword Research Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        80,
        912
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {
          "temperature": 0.3
        }
      },
      "id": "keyword-model-001",
      "name": "OpenAI Model - Keywords",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        80,
        1136
      ],
      "credentials": {
        "openAiApi": {
          "id": "5HFbmVROuozdyQ0Q",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"primaryKeywords\": {\n\t\t\t\"type\": \"array\",\n\t\t\t\"items\": {\n\t\t\t\t\"type\": \"string\"\n\t\t\t},\n\t\t\t\"description\": \"Primary SEO keywords (3-5 keywords including game name)\"\n\t\t},\n\t\t\"secondaryKeywords\": {\n\t\t\t\"type\": \"array\",\n\t\t\t\"items\": {\n\t\t\t\t\"type\": \"string\"\n\t\t\t},\n\t\t\t\"description\": \"Secondary SEO keywords (3-5 supporting keywords)\"\n\t\t},\n\t\t\"longTailKeywords\": {\n\t\t\t\"type\": \"array\",\n\t\t\t\"items\": {\n\t\t\t\t\"type\": \"string\"\n\t\t\t},\n\t\t\t\"description\": \"Long-tail keyword phrases (2-3 phrases)\"\n\t\t},\n\t\t\"keywordDensityTarget\": {\n\t\t\t\"type\": \"number\",\n\t\t\t\"description\": \"Target keyword density percentage for game name (1-2%)\"\n\t\t}\n\t}\n}"
      },
      "id": "keyword-parser-001",
      "name": "Keyword Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        208,
        1136
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=The game name is: {{ $json.gameName }}\nAngle: {{ $json.angle }}\nNews headline: {{ $json.headline ?? $json.output.headline }}\nSource: {{ $json.source ?? $json.output.source }}\nURL: {{ $json.url ?? $json.output.url }}\nPublish date: {{ $json.publishDate ?? $json.output.publishDate }}\nIs recent news (within 7 days): {{ $json.isRecentNews ?? $json.output.isRecentNews ?? true }}\nSummary: {{ $json.summary ?? $json.output.summary }}\nKey points: {{ $json.keyPoints ?? $json.output.keyPoints }}\nImage URL: {{ $json.imageUrl ?? $json.output.imageUrl }}\n\nSEO Keywords (for natural integration):\nPrimary: {{ $json.primaryKeywords ?? $json.output?.primaryKeywords ?? [] }}\nSecondary: {{ $json.secondaryKeywords ?? $json.output?.secondaryKeywords ?? [] }}\nLong-tail: {{ $json.longTailKeywords ?? $json.output?.longTailKeywords ?? [] }}\nTarget density: {{ $json.keywordDensityTarget ?? $json.output?.keywordDensityTarget ?? 1.5 }}%",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are a professional Danish gaming journalist writing for MetaView's automated gaming magazine. Your task is to write SEO-optimized, engaging articles perfectly formatted for web publication.\n\nCRITICAL INSTRUCTION: You MUST use the EXACT game name provided. NEVER replace it with placeholders like ****, [GAME NAME], or similar. Always write the actual game name throughout the article.\n\nHANDLING RECENT VS OLDER NEWS:\n- If isRecentNews is TRUE: Write as breaking/recent news with phrases like \"nyeste\", \"lige annonceret\", \"seneste opdatering\"\n- If isRecentNews is FALSE: Write as a relevant update/article with phrases like \"recent\", \"senest\", \"opdatering\", and mention the publish date naturally (e.g., \"I en artikel fra [date]...\")\n- Always make the article feel current and relevant, even if the news is older\n- Focus on why this news matters NOW to Danish gamers\n\nCONTENT STRUCTURE (CRITICAL FOR BLOG OPTIMIZATION):\n1. Opening paragraph (3-4 sentences): Hook the reader, mention game name, summarize the news\n2. Use H2 headings (##) for main sections - create 3-5 main sections\n3. Use H3 headings (###) for subsections within main sections\n4. Each paragraph should be 3-5 sentences maximum\n5. Use bullet lists (-) for key points, features, or takeaways\n6. Use numbered lists (1. 2. 3.) for step-by-step information or rankings\n7. Add blockquotes (>) for important quotes or callouts\n8. Use **bold** for emphasis on important terms\n9. Use *italic* for game names, titles, or emphasis\n10. Include links [text](url) to source articles or official sites\n\nWORD COUNT & DEPTH:\n- Target: 1000-1500 words for optimal SEO and engagement\n- Minimum: 800 words\n- Maximum: 2000 words\n- Each section should be substantial (150-300 words)\n- Balance depth with readability\n\nSEO OPTIMIZATION (Use provided keywords naturally):\n- Mention game name in first paragraph\n- Include game name in at least 3-5 headings\n- Naturally integrate PRIMARY keywords throughout the article (target density: {{ $json.keywordDensityTarget ?? $json.output?.keywordDensityTarget ?? 1.5 }}%)\n- Use SECONDARY keywords where relevant and natural\n- Incorporate LONG-TAIL keywords in appropriate sections\n- Use natural keyword variations - don't keyword stuff\n- Include relevant gaming terms\n- Write for humans first, SEO second - keywords should feel natural, not forced\n\nMARKDOWN FORMATTING RULES:\n- Use ## for main section headings (H2)\n- Use ### for subsection headings (H3)\n- Use - for bullet lists\n- Use 1. 2. 3. for numbered lists\n- Use > for blockquotes\n- Use **text** for bold\n- Use *text* for italic\n- Use [text](url) for links\n- Use `code` for game names, patch numbers, or technical terms\n- Separate paragraphs with double newlines (\\n\\n)\n- DO NOT include image markdown (![alt](url)) - images are handled separately\n\nCONTENT QUALITY:\n1. Write in fluent, natural Danish\n2. Use the EXACT game name from input - mention it early and naturally throughout\n3. Use an engaging, conversational tone suitable for gamers\n4. Include all key information from research\n5. Add relevant context for Danish readers\n6. Expand on key points with details, examples, and context\n7. Include background information where relevant\n8. Add quotes or community reactions if mentioned\n9. End with a strong conclusion paragraph\n\nTAG OPTIMIZATION:\n- Include the exact game name\n- Include game genre (e.g., \"Battle Royale\", \"RPG\", \"FPS\")\n- Include relevant topics (e.g., \"Opdatering\", \"Esports\", \"Nyheder\")\n- Include platform if relevant (e.g., \"PC\", \"Mobile\", \"Console\")\n- 5-8 tags total\n\nReturn the article with:\n- danishHeadline: Catchy Danish headline (50-70 chars) with the actual game name\n- danishArticle: Well-structured article (1000-1500 words) with proper markdown formatting:\n  * Opening paragraph with game name\n  * 3-5 H2 sections (##)\n  * H3 subsections (###) where appropriate\n  * Bullet or numbered lists for key points\n  * Blockquotes for important quotes\n  * Proper paragraph breaks (\\n\\n)\n  * NO image markdown\n- metaDescription: SEO-optimized description (150-160 characters exactly) with game name and key terms\n- tags: Array of 5-8 relevant tags in Danish including the game name"
        }
      },
      "id": "1c41282c-0c6a-437d-ab1d-97db994bc88b",
      "name": "Danish Article Writer",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        160,
        912
      ]
    },
    {
      "parameters": {
        "jsCode": "// Article Writer Validation - Validate article output completeness\nconst data = $input.item.json;\nconst headline = data.danishHeadline ?? data.output?.danishHeadline ?? '';\nconst article = data.danishArticle ?? data.output?.danishArticle ?? '';\nconst metaDescription = data.metaDescription ?? data.output?.metaDescription ?? '';\nconst tags = data.tags ?? data.output?.tags ?? [];\n\n// Check if article is complete and usable\nconst hasHeadline = headline && headline.trim().length > 0;\nconst hasArticle = article && article.trim().length > 200;\nconst hasMetaDescription = metaDescription && metaDescription.trim().length > 50;\nconst hasTags = Array.isArray(tags) && tags.length >= 3;\n\nconst articleQuality = {\n  isComplete: hasHeadline && hasArticle && hasMetaDescription && hasTags,\n  missingFields: [\n    !hasHeadline && 'danishHeadline',\n    !hasArticle && 'danishArticle',\n    !hasMetaDescription && 'metaDescription',\n    !hasTags && 'tags'\n  ].filter(Boolean),\n  qualityScore: (\n    (hasHeadline ? 25 : 0) +\n    (hasArticle ? 25 : 0) +\n    (hasMetaDescription ? 25 : 0) +\n    (hasTags ? 25 : 0)\n  )\n};\n\nreturn {\n  ...data,\n  articleQuality: articleQuality,\n  // If article is incomplete, flag it but don't fail - let SEO checker handle it\n  articleValid: articleQuality.qualityScore >= 75\n};"
      },
      "id": "article-writer-validation-001",
      "name": "Article Writer Validation",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        352,
        912
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "id-1",
              "leftValue": "={{ $json.articleValid ?? $json.articleQuality?.isComplete ?? false }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "check-article-valid-001",
      "name": "Check Article Valid",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        544,
        912
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {
          "temperature": 0.8
        }
      },
      "id": "6d10d123-cbdc-495e-887b-6d4cad7069eb",
      "name": "OpenAI Model - Writer",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        160,
        1136
      ],
      "credentials": {
        "openAiApi": {
          "id": "5HFbmVROuozdyQ0Q",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"danishHeadline\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Article headline in Danish\"\n\t\t},\n\t\t\"danishArticle\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Full article text in Danish\"\n\t\t},\n\t\t\"metaDescription\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"SEO meta description in Danish\"\n\t\t},\n\t\t\"tags\": {\n\t\t\t\"type\": \"array\",\n\t\t\t\"items\": {\n\t\t\t\t\"type\": \"string\"\n\t\t\t},\n\t\t\t\"description\": \"Relevant tags in Danish\"\n\t\t}\n\t}\n}"
      },
      "id": "93dc0e3f-2fc6-4a21-b0d3-3ff763035261",
      "name": "Article Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        288,
        1136
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Analyze the SEO quality of this Danish gaming article:\n\nHeadline: {{ $json.output.danishHeadline ?? $json.danishHeadline }}\nArticle: {{ $json.output.danishArticle ?? $json.danishArticle }}\nMeta Description: {{ $json.output.metaDescription ?? $json.metaDescription }}\nTags: {{ $json.output.tags ?? $json.tags }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an SEO expert specializing in Danish gaming blog content for MetaView. Analyze articles for web publication optimization.\n\nBLOG-SPECIFIC SEO CRITERIA:\n\n1. HEADLINE (Title):\n- Length: 50-70 characters (optimal for Google SERP)\n- Must include exact game name\n- Should be engaging and click-worthy\n- Include relevant keywords naturally\n\n2. META DESCRIPTION:\n- EXACTLY 150-160 characters (critical for SERP display) - count precisely!\n- Must include game name\n- Include key terms and call-to-action\n- Compelling and informative\n- If not exactly 150-160 chars, provide optimized version\n\n3. CONTENT STRUCTURE:\n- Word count: 1000-1500 words (optimal for SEO)\n- Proper H2 headings (##) - at least 3-5 sections\n- H3 subsections (###) for better organization\n- Paragraphs: 3-5 sentences max\n- Use lists (- or 1. 2. 3.) for key points\n- Game name mentioned in first paragraph\n- Game name in at least 3 headings\n\n4. KEYWORD OPTIMIZATION (CRITICAL - Calculate these):\n- Game name density: Calculate actual percentage - target 1-2% (natural, not stuffed)\n  Formula: (number of game name mentions / total word count) * 100\n- Verify game name appears in at least 3 headings (count them)\n- Check if primary keywords are naturally integrated\n- Verify secondary keywords are used appropriately\n- Long-tail keywords should appear naturally in content\n- Natural language flow (no keyword stuffing)\n\n5. HEADING ANALYSIS:\n- Count how many headings contain the game name\n- Verify heading hierarchy (H2 before H3)\n- Check if headings are descriptive and keyword-rich\n\n6. READABILITY:\n- Clear paragraph breaks\n- Proper heading hierarchy\n- Lists for scannability\n- Engaging tone\n\n7. TAGS:\n- 5-8 relevant tags\n- Include game name\n- Include genre/platform\n- Include topic keywords\n\nCRITICAL - You MUST return ALL required fields in the exact format:\n- seoScore: Overall SEO score (0-100) - be strict, aim for 80+ (REQUIRED - must be a number)\n- keywordDensity: Actual game name density percentage (calculate: (game name mentions / total words) * 100) (REQUIRED - must be a number)\n- headingKeywordCount: Number of headings containing game name (REQUIRED - must be a number)\n- strengths: Array of SEO strengths (REQUIRED - must be an array of strings, can be empty [])\n- improvements: Array of specific, actionable improvements (REQUIRED - must be an array of strings, can be empty [])\n- optimizedHeadline: Improved headline (50-70 chars) if current is not optimal, or empty string \"\" if current headline is already optimal (OPTIONAL - can be omitted or empty string)\n- optimizedMetaDescription: Improved meta description (EXACTLY 150-160 chars) if current is not optimal, or empty string \"\" if current is already optimal (OPTIONAL - can be omitted or empty string)\n\nIMPORTANT: Always return strengths and improvements as arrays, even if empty []. For optimizedHeadline and optimizedMetaDescription, return empty string \"\" if not needed (or omit the field entirely)."
        }
      },
      "id": "f8ad5a0d-80b6-4738-8c6e-79a0943d16c5",
      "name": "SEO Checker",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        512,
        912
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {
          "temperature": 0.2
        }
      },
      "id": "0976320c-7daf-483f-8072-daca56502cce",
      "name": "OpenAI Model - SEO",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        512,
        1136
      ],
      "credentials": {
        "openAiApi": {
          "id": "5HFbmVROuozdyQ0Q",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"seoScore\": {\n\t\t\t\"type\": \"number\",\n\t\t\t\"description\": \"Overall SEO score from 0 to 100\"\n\t\t},\n\t\t\"keywordDensity\": {\n\t\t\t\"type\": \"number\",\n\t\t\t\"description\": \"Actual game name keyword density percentage\"\n\t\t},\n\t\t\"headingKeywordCount\": {\n\t\t\t\"type\": \"number\",\n\t\t\t\"description\": \"Number of headings containing the game name\"\n\t\t},\n\t\t\"strengths\": {\n\t\t\t\"type\": \"array\",\n\t\t\t\"items\": {\n\t\t\t\t\"type\": \"string\"\n\t\t\t},\n\t\t\t\"description\": \"SEO strengths identified\"\n\t\t},\n\t\t\"improvements\": {\n\t\t\t\"type\": \"array\",\n\t\t\t\"items\": {\n\t\t\t\t\"type\": \"string\"\n\t\t\t},\n\t\t\t\"description\": \"Suggested SEO improvements\"\n\t\t},\n\t\t\"optimizedHeadline\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Improved headline if needed (50-70 chars), or empty string if current is optimal\"\n\t\t},\n\t\t\"optimizedMetaDescription\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Improved meta description if needed (EXACTLY 150-160 chars), or empty string if current is optimal\"\n\t\t}\n\t},\n\t\"required\": [\"seoScore\", \"keywordDensity\", \"headingKeywordCount\", \"strengths\", \"improvements\"]\n}"
      },
      "id": "03cba842-412b-431a-b991-fae67511af1b",
      "name": "SEO Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        640,
        1136
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Review this Danish gaming article for quality approval:\n\nHeadline: {{ $json.output.danishHeadline ?? $json.danishHeadline }}\nArticle: {{ $json.output.danishArticle ?? $json.danishArticle }}\nSEO Score: {{ $json.output.seoScore ?? $json.seoScore }}\nSEO Improvements: {{ $json.output.improvements ?? $json.improvements }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are a senior editor for MetaView's Danish gaming blog. Review articles for publication readiness.\n\nBLOG PUBLICATION STANDARDS:\n\n1. CONTENT QUALITY:\n- Accurate information\n- Engaging and informative\n- Natural Danish language\n- Proper grammar and spelling\n\n2. STRUCTURE & FORMATTING:\n- Proper markdown formatting (##, ###, -, 1. 2. 3., >)\n- Clear heading hierarchy\n- Well-organized sections\n- Proper paragraph breaks\n- Lists used appropriately\n\n3. SEO REQUIREMENTS:\n- SEO score >= 75 (prefer 80+)\n- Headline: 50-70 characters with game name\n- Meta description: 150-160 characters exactly\n- Word count: 1000-1500 words\n- Game name in first paragraph\n- Game name in multiple headings\n\n4. READABILITY:\n- Clear, engaging tone\n- Proper paragraph length (3-5 sentences)\n- Good flow between sections\n- Scannable with headings and lists\n\n5. COMPLETENESS:\n- All key points covered\n- Proper introduction and conclusion\n- Adequate depth\n- No missing information\n\nDecision rules:\n- Approve if: SEO score >= 75 AND quality score >= 75 AND content quality is high AND structure is proper\n- Reject if: SEO score < 75 OR quality score < 70 OR content quality is low OR structure is poor\n- Only require revision for CRITICAL issues: SEO < 75 OR quality < 70\n- Accept \"good enough\" articles: SEO >= 75 AND quality >= 75 (even if not perfect)\n\nProvide:\n- approved: Boolean (true/false)\n- qualityScore: Overall quality score (0-100)\n- feedback: Detailed feedback focusing on blog optimization\n- requiredChanges: Array of specific, actionable changes needed if not approved"
        }
      },
      "id": "3bc81085-915c-470f-bcfc-53290f93d859",
      "name": "Quality Control Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        1088,
        784
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {
          "temperature": 0.2
        }
      },
      "id": "5f094263-922e-43b7-868e-6f53654a3fac",
      "name": "OpenAI Model - QC",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        1104,
        1008
      ],
      "credentials": {
        "openAiApi": {
          "id": "5HFbmVROuozdyQ0Q",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"approved\": {\n\t\t\t\"type\": \"boolean\",\n\t\t\t\"description\": \"Whether the article is approved for publication\"\n\t\t},\n\t\t\"qualityScore\": {\n\t\t\t\"type\": \"number\",\n\t\t\t\"description\": \"Overall quality score from 0 to 100\"\n\t\t},\n\t\t\"feedback\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Detailed feedback on the article\"\n\t\t},\n\t\t\"requiredChanges\": {\n\t\t\t\"type\": \"array\",\n\t\t\t\"items\": {\n\t\t\t\t\"type\": \"string\"\n\t\t\t},\n\t\t\t\"description\": \"Specific changes needed if not approved\"\n\t\t}\n\t}\n}"
      },
      "id": "5e7677b4-b1a5-4e32-a901-e275c7fd4b3b",
      "name": "QC Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1232,
        1008
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "id-1",
              "leftValue": "={{ $json.output?.approved ?? $json.approved }}",
              "rightValue": "true",
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            },
            {
              "id": "id-2",
              "leftValue": "={{ $json.currentRevision }}",
              "rightValue": "={{ $json.maxRevisions }}",
              "operator": {
                "type": "number",
                "operation": "gte"
              }
            },
            {
              "id": "id-3",
              "leftValue": "={{ (() => { const seo = $json.seoScore ?? $json.output?.seoScore ?? null; const quality = $json.qualityScore ?? $json.output?.qualityScore ?? null; return seo !== null && seo >= 75 && quality !== null && quality >= 75; })() }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "650597f8-30a5-4a8c-bbb3-11b737434655",
      "name": "Check Quality Approval",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1664,
        784
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Game name: {{ $json.gameName }}\nOriginal Headline: {{ $json.output.danishHeadline ?? $json.danishHeadline }}\nOriginal Article: {{ $json.output.danishArticle ?? $json.danishArticle }}\nFeedback: {{ $json.output.feedback ?? $json.feedback }}\nRequired Changes: {{ $json.output.requiredChanges ?? $json.requiredChanges }}\nSEO Improvements: {{ $json.output.improvements ?? $json.improvements }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are a professional Danish gaming journalist improving articles for MetaView's blog publication.\n\nCRITICAL INSTRUCTION: You MUST use the EXACT game name provided. NEVER replace it with placeholders like ****, [GAME NAME], or similar. Always write the actual game name throughout.\n\nBLOG OPTIMIZATION REQUIREMENTS:\n\n1. STRUCTURE (Maintain/Improve):\n- Opening paragraph (3-4 sentences) with game name\n- 3-5 H2 sections (##) with descriptive headings\n- H3 subsections (###) where appropriate\n- Proper paragraph breaks (\\n\\n)\n- Use lists (- or 1. 2. 3.) for key points\n- Use blockquotes (>) for important quotes\n- Strong conclusion paragraph\n\n2. SEO OPTIMIZATION:\n- Headline: 50-70 characters, includes game name\n- Meta description: EXACTLY 150-160 characters\n- Word count: 1000-1500 words\n- Game name in first paragraph\n- Game name in at least 3 headings\n- Natural keyword integration\n\n3. CONTENT QUALITY:\n- Address all feedback points\n- Implement SEO improvements\n- Maintain core message and facts\n- Improve Danish language quality\n- Enhance engagement and readability\n- Use actual game name throughout\n\n4. MARKDOWN FORMATTING:\n- Use ## for main sections\n- Use ### for subsections\n- Use - for bullet lists\n- Use 1. 2. 3. for numbered lists\n- Use > for blockquotes\n- Use **text** for bold\n- Use *text* for italic\n- Use [text](url) for links\n- NO image markdown (![alt](url))\n\nReturn the improved article with:\n- danishHeadline: Optimized headline (50-70 chars) with game name\n- danishArticle: Well-structured article (1000-1500 words) with proper markdown\n- metaDescription: SEO-optimized (150-160 chars exactly) with game name\n- tags: 5-8 relevant tags including game name\n- changesApplied: Array describing what was changed"
        }
      },
      "id": "06aaf165-d143-405e-bc38-bc2b4755cb0c",
      "name": "Article Fixer",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        1888,
        656
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {
          "temperature": 0.3
        }
      },
      "id": "9c192a07-6f96-4c1c-b902-b42f8224c058",
      "name": "OpenAI Model - Fixer",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        1904,
        880
      ],
      "credentials": {
        "openAiApi": {
          "id": "5HFbmVROuozdyQ0Q",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"danishHeadline\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Improved headline in Danish\"\n\t\t},\n\t\t\"danishArticle\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Improved article text in Danish\"\n\t\t},\n\t\t\"metaDescription\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Improved meta description in Danish\"\n\t\t},\n\t\t\"tags\": {\n\t\t\t\"type\": \"array\",\n\t\t\t\"items\": {\n\t\t\t\t\"type\": \"string\"\n\t\t\t},\n\t\t\t\"description\": \"Updated relevant tags\"\n\t\t},\n\t\t\"changesApplied\": {\n\t\t\t\"type\": \"array\",\n\t\t\t\"items\": {\n\t\t\t\t\"type\": \"string\"\n\t\t\t},\n\t\t\t\"description\": \"Description of changes made\"\n\t\t}\n\t}\n}"
      },
      "id": "67726e40-0a7d-47fa-9e96-5c2d0653d9ae",
      "name": "Fixer Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        2032,
        880
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "status",
              "value": "Approved",
              "type": "string"
            },
            {
              "id": "id-2",
              "name": "finalHeadline",
              "value": "={{ (() => {\n  const cur = $json.danishHeadline ?? $json.output?.danishHeadline;\n  if (cur) return cur;\n\n  try {\n    const j = $node[\"Article Fixer\"].json;\n    const v = j.danishHeadline ?? j.output?.danishHeadline;\n    if (v) return v;\n  } catch (e) {}\n\n  try {\n    const j = $node[\"Danish Article Writer\"].json;\n    const v = j.danishHeadline ?? j.output?.danishHeadline;\n    if (v) return v;\n  } catch (e) {}\n\n  return \"\";\n})() }}",
              "type": "string"
            },
            {
              "id": "id-3",
              "name": "finalArticle",
              "value": "={{ (() => {\n  const cur = $json.danishArticle ?? $json.output?.danishArticle;\n  if (cur) return cur;\n\n  try {\n    const j = $node[\"Article Fixer\"].json;\n    const v = j.danishArticle ?? j.output?.danishArticle;\n    if (v) return v;\n  } catch (e) {}\n\n  try {\n    const j = $node[\"Danish Article Writer\"].json;\n    const v = j.danishArticle ?? j.output?.danishArticle;\n    if (v) return v;\n  } catch (e) {}\n\n  return \"\";\n})() }}",
              "type": "string"
            },
            {
              "id": "id-4",
              "name": "finalMetaDescription",
              "value": "={{ (() => {\n  const cur = $json.metaDescription ?? $json.output?.metaDescription;\n  if (cur) return cur;\n\n  try {\n    const j = $node[\"Article Fixer\"].json;\n    const v = j.metaDescription ?? j.output?.metaDescription;\n    if (v) return v;\n  } catch (e) {}\n\n  try {\n    const j = $node[\"Danish Article Writer\"].json;\n    const v = j.metaDescription ?? j.output?.metaDescription;\n    if (v) return v;\n  } catch (e) {}\n\n  return \"\";\n})() }}",
              "type": "string"
            },
            {
              "id": "id-5",
              "name": "finalTags",
              "value": "={{ (() => {\n  let t = $json.tags ?? $json.output?.tags;\n\n  if (t == null) {\n    try {\n      const j = $node[\"Article Fixer\"].json;\n      t = j.tags ?? j.output?.tags;\n    } catch (e) {}\n  }\n\n  if (t == null) {\n    try {\n      const j = $node[\"Danish Article Writer\"].json;\n      t = j.tags ?? j.output?.tags;\n    } catch (e) {}\n  }\n\n  if (Array.isArray(t)) return t.map(s => String(s).trim()).filter(Boolean);\n\n  if (typeof t === 'string') return t.split(',').map(s => s.trim()).filter(Boolean);\n\n  return [];\n})() }}",
              "type": "array"
            },
            {
              "id": "id-7",
              "name": "seoScore",
              "value": "={{ (() => {\n  const cur = $json.seoScore ?? $json.output?.seoScore;\n  if (cur !== undefined && cur !== null) return cur;\n  try { return $node[\"Preserve Fields After SEO\"].json.seoScore ?? $node[\"Preserve Fields After SEO\"].json.output?.seoScore ?? null; } catch (e) {}\n  return null;\n})() }}",
              "type": "number"
            },
            {
              "id": "id-8",
              "name": "qualityScore",
              "value": "={{ (() => {\n  const cur = $json.qualityScore ?? $json.output?.qualityScore;\n  if (cur !== undefined && cur !== null) return cur;\n  try { return $node[\"Preserve Fields After QC\"].json.qualityScore ?? $node[\"Preserve Fields After QC\"].json.output?.qualityScore ?? null; } catch (e) {}\n  return null;\n})() }}",
              "type": "number"
            },
            {
              "id": "id-blogTitle",
              "name": "blogTitle",
              "type": "string",
              "value": "={{ $json.finalHeadline ?? $json.danishHeadline ?? $json.output?.danishHeadline ?? '' }}"
            },
            {
              "id": "id-blogSlug",
              "name": "blogSlug",
              "type": "string",
              "value": "={{ (() => {\n  const headline = $json.finalHeadline ?? $json.danishHeadline ?? $json.output?.danishHeadline ?? '';\n  return headline.toLowerCase().replace(/[æ]/g, 'ae').replace(/[ø]/g, 'oe').replace(/[å]/g, 'aa').replace(/[^\\w\\s-]/g, '').replace(/[\\s_-]+/g, '-').replace(/^-+|-+$/g, '').substring(0, 80);\n})() }}"
            },
            {
              "id": "id-blogExcerpt",
              "name": "blogExcerpt",
              "type": "string",
              "value": "={{ (() => {\n  // Prefer meta description, then generate from article\n  const meta = $json.finalMetaDescription ?? $json.metaDescription ?? $json.output?.metaDescription ?? '';\n  if (meta && meta.length >= 100) return meta.substring(0, 200);\n  \n  const article = $json.finalArticle ?? $json.danishArticle ?? $json.output?.danishArticle ?? '';\n  const clean = article.replace(/[#*_\\[\\]()]/g, '').replace(/\\n+/g, ' ').trim();\n  // Target 150-200 characters for excerpt (blog recommendation)\n  if (clean.length <= 200) return clean;\n  return clean.substring(0, 200).replace(/\\s+\\S*$/, '') + '...';\n})() }}"
            },
            {
              "id": "id-blogContent",
              "name": "blogContent",
              "type": "string",
              "value": "={{ $json.finalArticle ?? $json.danishArticle ?? $json.output?.danishArticle ?? '' }}"
            },
            {
              "id": "id-blogTags",
              "name": "blogTags",
              "type": "string",
              "value": "={{ (() => {\n  const t = $json.finalTags ?? $json.tags ?? $json.output?.tags ?? [];\n  if (Array.isArray(t)) return t.join(', ');\n  return String(t);\n})() }}"
            },
            {
              "id": "id-blogMetaDesc",
              "name": "blogMetaDescription",
              "type": "string",
              "value": "={{ (() => {\n  const meta = $json.finalMetaDescription ?? $json.metaDescription ?? $json.output?.metaDescription ?? '';\n  // Ensure exactly 150-160 characters for optimal SEO\n  if (!meta) return '';\n  if (meta.length <= 160) return meta;\n  // Trim to 160 chars, but try to end at word boundary\n  const trimmed = meta.substring(0, 160);\n  const lastSpace = trimmed.lastIndexOf(' ');\n  if (lastSpace > 140) return trimmed.substring(0, lastSpace);\n  return trimmed;\n})() }}"
            },
            {
              "id": "id-blogImage",
              "name": "blogFeaturedImage",
              "type": "string",
              "value": "={{ $json.imageUrl ?? $json.output?.imageUrl ?? $('Research Agent').first().json.output?.imageUrl ?? $('Research Agent').first().json.imageUrl ?? '' }}"
            },
            {
              "id": "id-blogContentImage",
              "name": "blogContentImage",
              "type": "string",
              "value": "={{ $json.contentImageUrl ?? $json.output?.contentImageUrl ?? $('Image URL Validator').first().json.output?.contentImageUrl ?? $('Image URL Validator').first().json.contentImageUrl ?? '' }}"
            },
            {
              "id": "id-blogImprovements",
              "name": "improvements",
              "type": "array",
              "value": "={{ (() => {\n  const cur = $json.improvements ?? $json.output?.improvements;\n  if (cur && Array.isArray(cur) && cur.length > 0) return cur;\n  try { return $node[\"Preserve Fields After SEO\"].json.improvements ?? $node[\"Preserve Fields After SEO\"].json.output?.improvements ?? []; } catch (e) {}\n  return [];\n})() }}"
            },
            {
              "id": "id-blogWorkflowStart",
              "name": "workflowStartTime",
              "type": "number",
              "value": "={{ $json.workflowStartTime ?? $('Workflow Configuration').first().json.workflowStartTime ?? Date.now() }}"
            },
            {
              "id": "id-blogCurrentRevision",
              "name": "currentRevision",
              "type": "number",
              "value": "={{ $json.currentRevision ?? 0 }}"
            }
          ]
        },
        "options": {}
      },
      "id": "544b0a6a-de5c-41d0-a5f4-0fe75c2a36c8",
      "name": "Final Result",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2688,
        784
      ]
    },
    {
      "parameters": {
        "sendTo": "={{ $('Game Selection Form').first().json.userEmail }}",
        "subject": "=✅ Din artikel er klar: {{ $json.blogTitle || $json.finalHeadline || 'Artikel' }}",
        "emailType": "html",
        "text": "={{ (() => {\n  const data = $json || {};\n  const title = data.blogTitle || data.finalHeadline || '';\n  const slug = data.blogSlug || data.slug || '';\n  const excerpt = data.blogExcerpt || data.excerpt || '';\n  const content = data.blogContent || data.finalArticle || data.danishArticle || '';\n  const tags = Array.isArray(data.blogTags) ? data.blogTags.join(', ') : (data.blogTags || (Array.isArray(data.finalTags) ? data.finalTags.join(', ') : (data.finalTags || '')));\n  const meta = data.blogMetaDescription || data.finalMetaDescription || data.metaDescription || '';\n  const image = data.blogFeaturedImage || data.featured_image || data.imageUrl || '';\n  const seo = data.seoScore || 'N/A';\n  const quality = data.qualityScore || 'N/A';\n  \n  return '✅ ARTIKEL GENERERET\\n\\n' +\n    'SEO Score: ' + seo + ' | Quality Score: ' + quality + '\\n\\n' +\n    '📝 TITLE\\n' + title + '\\n\\n' +\n    '🔗 SLUG\\n' + slug + '\\n\\n' +\n    '📋 EXCERPT\\n' + excerpt + '\\n\\n' +\n    '🏷️ TAGS\\n' + tags + '\\n\\n' +\n    '🔍 META DESCRIPTION\\n' + meta + '\\n\\n' +\n    '🖼️ FEATURED IMAGE URL\\n' + (image || 'Ingen billede fundet') + '\\n\\n' +\n    '📄 CONTENT (MARKDOWN)\\n' + content + '\\n\\n' +\n    'Kopier hver sektion og indsæt i blog admin på: https://mymetaview.com/app/admin/blog/new';\n})() }}",
        "attachments": "={{ (() => {\n  const data = $json || {};\n  const title = data.blogTitle || data.finalHeadline || '';\n  const slug = data.blogSlug || data.slug || '';\n  const excerpt = data.blogExcerpt || data.excerpt || '';\n  const content = data.blogContent || data.finalArticle || data.danishArticle || '';\n  const tags = Array.isArray(data.blogTags) ? data.blogTags.join(', ') : (data.blogTags || (Array.isArray(data.finalTags) ? data.finalTags.join(', ') : (data.finalTags || '')));\n  const meta = data.blogMetaDescription || data.finalMetaDescription || data.metaDescription || '';\n  const image = data.blogFeaturedImage || data.featured_image || data.imageUrl || '';\n  \n  // Create JSON file for direct import\n  const jsonData = {\n    title: title,\n    slug: slug,\n    excerpt: excerpt,\n    content: content,\n    featured_image: image || '',\n    featured_image_alt: '',\n    og_image: image || '',\n    author_name: '',\n    author_bio: '',\n    author_avatar: '',\n    category_id: undefined,\n    tags: tags,\n    status: 'draft',\n    is_featured: false,\n    is_pinned: false,\n    meta_title: title,\n    meta_description: meta,\n    meta_keywords: tags.split(', ').slice(0, 5).join(', '),\n    canonical_url: '',\n    no_index: false,\n    schema_type: 'Article',\n    twitter_title: title.substring(0, 70),\n    twitter_description: meta,\n    twitter_image: image || ''\n  };\n  \n  const jsonString = JSON.stringify(jsonData, null, 2);\n  \n  return [{\n    name: 'blog-post-import.json',\n    data: Buffer.from(jsonString).toString('base64'),\n    type: 'application/json'\n  }];\n})() }}",
        "html": "={{ (() => {\n  const data = $json || {};\n  const title = (data.blogTitle || data.finalHeadline || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n  const slug = (data.blogSlug || data.slug || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n  const excerpt = (data.blogExcerpt || data.excerpt || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n  const content = (data.blogContent || data.finalArticle || data.danishArticle || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n  const tags = (Array.isArray(data.blogTags) ? data.blogTags.join(', ') : (data.blogTags || (Array.isArray(data.finalTags) ? data.finalTags.join(', ') : (data.finalTags || '')))).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n  const meta = (data.blogMetaDescription || data.finalMetaDescription || data.metaDescription || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n  const image = (data.blogFeaturedImage || data.featured_image || data.imageUrl || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n  const seo = data.seoScore || 'N/A';\n  const quality = data.qualityScore || 'N/A';\n  const revisions = data.currentRevision || 0;\n  const startTime = data.workflowStartTime || Date.now();\n  const executionTime = Math.round((Date.now() - startTime) / 1000);\n  const executionMinutes = Math.floor(executionTime / 60);\n  const executionSeconds = executionTime % 60;\n  const execTimeStr = executionMinutes > 0 ? executionMinutes + 'm ' + executionSeconds + 's' : executionSeconds + 's';\n  const improvements = data.improvements || data.output?.improvements || [];\n  const showImprovements = (typeof seo === 'number' && seo < 85) || (typeof quality === 'number' && quality < 85);\n  \n  return '<!DOCTYPE html><html><head><meta charset=\"UTF-8\"></head><body style=\"font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px;\">' +\n    '<div style=\"max-width: 700px; margin: 0 auto; background: white; border-radius: 10px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);\">' +\n    '<h1 style=\"color: #f97316; margin-bottom: 5px;\">✅ Artikel Genereret!</h1>' +\n    '<div style=\"background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 15px; margin-bottom: 20px;\">' +\n    '<div style=\"display: flex; justify-content: space-between; flex-wrap: wrap; gap: 15px;\">' +\n    '<div><strong style=\"color: #0369a1;\">SEO Score:</strong> <span style=\"font-size: 1.2em; color: ' + (typeof seo === 'number' && seo >= 80 ? '#10b981' : typeof seo === 'number' && seo >= 75 ? '#f59e0b' : '#ef4444') + ';\">' + seo + '</span></div>' +\n    '<div><strong style=\"color: #0369a1;\">Quality Score:</strong> <span style=\"font-size: 1.2em; color: ' + (typeof quality === 'number' && quality >= 80 ? '#10b981' : typeof quality === 'number' && quality >= 75 ? '#f59e0b' : '#ef4444') + ';\">' + quality + '</span></div>' +\n    '<div><strong style=\"color: #0369a1;\">Revisions:</strong> ' + revisions + '</div>' +\n    '<div><strong style=\"color: #0369a1;\">Execution Time:</strong> ' + execTimeStr + '</div>' +\n    '</div></div>' +\n    '<div style=\"background: #fff8f3; border-left: 4px solid #f97316; padding: 15px; margin-bottom: 20px;\">' +\n    '<p style=\"margin: 0; font-size: 0.9em; font-weight: bold; margin-bottom: 8px;\">📎 JSON fil vedhæftet!</p>' +\n    '<p style=\"margin: 0; font-size: 0.9em;\">Download <strong>blog-post-import.json</strong> fra email vedhæftninger og upload den direkte i blog admin for automatisk import. Alternativt kan du kopiere hver sektion nedenfor manuelt.</p>' +\n    '</div>' +\n    '<h3 style=\"color: #333; border-bottom: 2px solid #f97316; padding-bottom: 5px;\">📝 Title</h3>' +\n    '<div style=\"background: #f9f9f9; padding: 15px; border-radius: 5px; margin-bottom: 20px; font-size: 1.1em;\">' + title + '</div>' +\n    '<h3 style=\"color: #333; border-bottom: 2px solid #f97316; padding-bottom: 5px;\">🔗 Slug</h3>' +\n    '<div style=\"background: #f9f9f9; padding: 15px; border-radius: 5px; margin-bottom: 20px; font-family: monospace;\">' + slug + '</div>' +\n    '<h3 style=\"color: #333; border-bottom: 2px solid #f97316; padding-bottom: 5px;\">📋 Excerpt</h3>' +\n    '<div style=\"background: #f9f9f9; padding: 15px; border-radius: 5px; margin-bottom: 20px;\">' + excerpt + '</div>' +\n    '<h3 style=\"color: #333; border-bottom: 2px solid #f97316; padding-bottom: 5px;\">🏷️ Tags</h3>' +\n    '<div style=\"background: #f9f9f9; padding: 15px; border-radius: 5px; margin-bottom: 20px;\">' + tags + '</div>' +\n    '<h3 style=\"color: #333; border-bottom: 2px solid #f97316; padding-bottom: 5px;\">🔍 Meta Description</h3>' +\n    '<div style=\"background: #f9f9f9; padding: 15px; border-radius: 5px; margin-bottom: 20px;\">' + meta + '</div>' +\n    '<h3 style=\"color: #333; border-bottom: 2px solid #f97316; padding-bottom: 5px;\">🖼️ Featured Image URL</h3>' +\n    '<div style=\"background: #f9f9f9; padding: 15px; border-radius: 5px; margin-bottom: 10px; word-break: break-all;\">' + (image || 'Ingen billede fundet') + '</div>' +\n    (image ? '<img src=\"' + image + '\" alt=\"Preview\" style=\"max-width: 100%; border-radius: 5px; margin-bottom: 20px;\">' : '') +\n    '<h3 style=\"color: #333; border-bottom: 2px solid #f97316; padding-bottom: 5px;\">📄 Content (Markdown)</h3>' +\n    '<div style=\"background: #f9f9f9; padding: 15px; border-radius: 5px; margin-bottom: 20px; white-space: pre-wrap; font-family: monospace; font-size: 0.9em; line-height: 1.6;\">' + content + '</div>' +\n    '<div style=\"background: #e8f5e9; border: 2px solid #4caf50; border-radius: 8px; padding: 20px; margin-top: 30px;\">' +\n    '<h3 style=\"color: #2e7d32; margin-bottom: 10px;\">📎 JSON Import Fil</h3>' +\n    '<p style=\"color: #555; margin-bottom: 15px; font-size: 0.9em;\">Kopier JSON-koden nedenfor, gem den som <strong>blog-post-import.json</strong>, og upload den i blog admin for automatisk import.</p>' +\n    '<div style=\"background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 5px; overflow-x: auto; font-family: monospace; font-size: 0.85em; line-height: 1.5; max-height: 400px; overflow-y: auto;\">' +\n    (() => {\n      const jsonData = {\n        title: data.blogTitle || data.finalHeadline || '',\n        slug: data.blogSlug || data.slug || '',\n        excerpt: data.blogExcerpt || data.excerpt || '',\n        content: data.blogContent || data.finalArticle || data.danishArticle || '',\n        featured_image: (data.blogFeaturedImage || data.featured_image || data.imageUrl || ''),\n        featured_image_alt: '',\n        og_image: (data.blogFeaturedImage || data.featured_image || data.imageUrl || ''),\n        author_name: '',\n        author_bio: '',\n        author_avatar: '',\n        tags: (Array.isArray(data.blogTags) ? data.blogTags.join(', ') : (data.blogTags || (Array.isArray(data.finalTags) ? data.finalTags.join(', ') : (data.finalTags || '')))),\n        status: 'draft',\n        is_featured: false,\n        is_pinned: false,\n        meta_title: (data.blogTitle || data.finalHeadline || ''),\n        meta_description: (data.blogMetaDescription || data.finalMetaDescription || data.metaDescription || ''),\n        meta_keywords: (Array.isArray(data.blogTags) ? data.blogTags.join(', ') : (data.blogTags || (Array.isArray(data.finalTags) ? data.finalTags.join(', ') : (data.finalTags || '')))).split(', ').slice(0, 5).join(', '),\n        canonical_url: '',\n        no_index: false,\n        schema_type: 'Article',\n        twitter_title: (data.blogTitle || data.finalHeadline || '').substring(0, 70),\n        twitter_description: (data.blogMetaDescription || data.finalMetaDescription || data.metaDescription || ''),\n        twitter_image: (data.blogFeaturedImage || data.featured_image || data.imageUrl || '')\n      };\n      return JSON.stringify(jsonData, null, 2).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n    })() +\n    '</div>' +\n    '<p style=\"color: #666; margin-top: 10px; font-size: 0.85em;\">💡 Tip: Vælg hele JSON-koden ovenfor (Ctrl+A eller Cmd+A), kopier den (Ctrl+C eller Cmd+C), åbn en teksteditor, indsæt den, og gem filen som <strong>blog-post-import.json</strong></p>' +\n    '</div>' +\n    (showImprovements && improvements.length > 0 ? '<div style=\"background: #fef3c7; border: 2px solid #f59e0b; border-radius: 8px; padding: 20px; margin-top: 30px;\">' +\n    '<h3 style=\"color: #92400e; margin-bottom: 10px;\">💡 Forbedringsforslag</h3>' +\n    '<p style=\"color: #78350f; margin-bottom: 10px; font-size: 0.9em;\">Artiklen kunne forbedres med følgende:</p>' +\n    '<ul style=\"color: #78350f; margin: 0; padding-left: 20px; font-size: 0.9em;\">' +\n    improvements.slice(0, 5).map(function(imp) { return '<li style=\"margin-bottom: 5px;\">' + String(imp).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</li>'; }).join('') +\n    '</ul></div>' : '') +\n    '<div style=\"background: #f3f4f6; border-radius: 8px; padding: 15px; margin-top: 30px; text-align: center;\">' +\n    '<p style=\"color: #6b7280; font-size: 0.85em; margin: 0;\">Generated by Gaming News Generator</p>' +\n    '<p style=\"color: #9ca3af; font-size: 0.75em; margin: 5px 0 0 0;\">Execution time: ' + execTimeStr + ' | Revisions: ' + revisions + '</p>' +\n    '</div>' +\n    '</div></body></html>';\n})() }}",
        "options": {}
      },
      "id": "email-output",
      "name": "Send Article Email",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        2928,
        784
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "currentRevision",
              "value": "={{ ($json.currentRevision ?? 0) + 1 }}",
              "type": "number"
            },
            {
              "id": "id-2",
              "name": "danishHeadline",
              "value": "={{ $json.output?.danishHeadline ?? $json.danishHeadline }}",
              "type": "string"
            },
            {
              "id": "id-3",
              "name": "danishArticle",
              "value": "={{ $json.output?.danishArticle ?? $json.danishArticle }}",
              "type": "string"
            },
            {
              "id": "id-4",
              "name": "metaDescription",
              "value": "={{ $json.output?.metaDescription ?? $json.metaDescription }}",
              "type": "string"
            },
            {
              "id": "id-5",
              "name": "tags",
              "value": "={{ (() => { const t = $json.tags ?? $json.output?.tags; if (Array.isArray(t)) return t; if (typeof t === 'string') return t.split(',').map(s => s.trim()).filter(Boolean); return []; })() }}",
              "type": "array"
            },
            {
              "id": "id-6",
              "name": "maxRevisions",
              "value": "={{ $('Workflow Configuration').first().json.maxRevisions }}",
              "type": "number"
            },
            {
              "id": "id-7",
              "name": "gameName",
              "value": "={{ $json.gameName ?? $('Workflow Configuration').first().json.gameName }}",
              "type": "string"
            },
            {
              "id": "id-8",
              "name": "maxArticleLength",
              "value": "={{ $json.maxArticleLength ?? $('Workflow Configuration').first().json.maxArticleLength }}",
              "type": "number"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "8a0f19c2-491b-42cb-a467-0a310b0ee69f",
      "name": "Increment Revision Counter",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2240,
        656
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "id-1",
              "leftValue": "={{ $json.currentRevision }}",
              "rightValue": "={{ $json.maxRevisions }}",
              "operator": {
                "type": "number",
                "operation": "gte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "2665aa1a-a1e7-4307-a89a-530b872721a2",
      "name": "Check Revision Limit",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        2464,
        656
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "seoScore",
              "value": "={{ $json.seoScore ?? $json.output?.seoScore }}",
              "type": "number"
            },
            {
              "id": "id-2",
              "name": "improvements",
              "value": "={{ $json.improvements ?? $json.output?.improvements }}",
              "type": "array"
            },
            {
              "id": "id-3",
              "name": "strengths",
              "value": "={{ $json.strengths ?? $json.output?.strengths }}",
              "type": "array"
            },
            {
              "id": "id-4",
              "name": "danishHeadline",
              "value": "={{ (() => {\n  const cur = $json.danishHeadline ?? $json.output?.danishHeadline;\n  if (cur) return cur;\n\n  try {\n    const j = $node[\"Article Fixer\"].json;\n    const v = j.danishHeadline ?? j.output?.danishHeadline;\n    if (v) return v;\n  } catch (e) {}\n\n  try {\n    const j = $node[\"Danish Article Writer\"].json;\n    const v = j.danishHeadline ?? j.output?.danishHeadline;\n    if (v) return v;\n  } catch (e) {}\n\n  return \"\";\n})() }}",
              "type": "string"
            },
            {
              "id": "id-5",
              "name": "danishArticle",
              "value": "={{ (() => {\n  const cur = $json.danishArticle ?? $json.output?.danishArticle;\n  if (cur) return cur;\n\n  try {\n    const j = $node[\"Article Fixer\"].json;\n    const v = j.danishArticle ?? j.output?.danishArticle;\n    if (v) return v;\n  } catch (e) {}\n\n  try {\n    const j = $node[\"Danish Article Writer\"].json;\n    const v = j.danishArticle ?? j.output?.danishArticle;\n    if (v) return v;\n  } catch (e) {}\n\n  return \"\";\n})() }}",
              "type": "string"
            },
            {
              "id": "id-6",
              "name": "metaDescription",
              "value": "={{ (() => {\n  const cur = $json.metaDescription ?? $json.output?.metaDescription;\n  if (cur) return cur;\n\n  try {\n    const j = $node[\"Article Fixer\"].json;\n    const v = j.metaDescription ?? j.output?.metaDescription;\n    if (v) return v;\n  } catch (e) {}\n\n  try {\n    const j = $node[\"Danish Article Writer\"].json;\n    const v = j.metaDescription ?? j.output?.metaDescription;\n    if (v) return v;\n  } catch (e) {}\n\n  return \"\";\n})() }}",
              "type": "string"
            },
            {
              "id": "id-7",
              "name": "tags",
              "value": "={{ (() => {\n  let t = $json.tags ?? $json.output?.tags;\n\n  if (t == null) {\n    try {\n      const j = $node[\"Article Fixer\"].json;\n      t = j.tags ?? j.output?.tags;\n    } catch (e) {}\n  }\n\n  if (t == null) {\n    try {\n      const j = $node[\"Danish Article Writer\"].json;\n      t = j.tags ?? j.output?.tags;\n    } catch (e) {}\n  }\n\n  if (Array.isArray(t)) return t.map(s => String(s).trim()).filter(Boolean);\n\n  if (typeof t === 'string') return t.split(',').map(s => s.trim()).filter(Boolean);\n\n  return [];\n})() }}",
              "type": "array"
            },
            {
              "id": "id-8",
              "name": "currentRevision",
              "value": "={{ $json.currentRevision ?? 0 }}",
              "type": "number"
            },
            {
              "id": "id-9",
              "name": "maxRevisions",
              "value": "={{ $json.maxRevisions }}",
              "type": "number"
            },
            {
              "id": "id-10",
              "name": "gameName",
              "value": "={{ $json.gameName }}",
              "type": "string"
            },
            {
              "id": "id-11",
              "name": "maxArticleLength",
              "value": "={{ $json.maxArticleLength }}",
              "type": "number"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "efad07bd-d9b0-489e-a16c-79399e8df56e",
      "name": "Preserve Fields After SEO",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        864,
        784
      ]
    },
    {
      "parameters": {
        "jsCode": "// Early Exit Check - Skip QC if critical issues detected\nconst data = $input.item.json;\nconst seoScore = data.seoScore ?? data.output?.seoScore ?? null;\nconst seoCriticalThreshold = data.seoCriticalThreshold ?? 60;\nconst article = data.danishArticle ?? data.output?.danishArticle ?? '';\nconst wordCount = article.split(/\\s+/).filter(w => w.length > 0).length;\n\n// Check for critical issues that require immediate fixing\nconst needsEarlyFix = (\n  (seoScore !== null && seoScore < seoCriticalThreshold) ||\n  wordCount < 500 ||\n  wordCount > 2500\n);\n\nreturn {\n  ...data,\n  needsEarlyFix: needsEarlyFix,\n  wordCount: wordCount,\n  earlyExitReason: needsEarlyFix ? (\n    seoScore !== null && seoScore < seoCriticalThreshold ? 'low_seo_score' :\n    wordCount < 500 ? 'too_short' :\n    'too_long'\n  ) : null\n};"
      },
      "id": "early-exit-check-001",
      "name": "Early Exit Check",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1056,
        784
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "id-1",
              "leftValue": "={{ $json.needsEarlyFix }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "early-exit-if-001",
      "name": "Check Early Exit",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1248,
        784
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "approved",
              "value": "={{ $json.approved ?? $json.output?.approved }}",
              "type": "boolean"
            },
            {
              "id": "id-2",
              "name": "qualityScore",
              "value": "={{ $json.qualityScore ?? $json.output?.qualityScore }}",
              "type": "number"
            },
            {
              "id": "id-3",
              "name": "feedback",
              "value": "={{ $json.feedback ?? $json.output?.feedback }}",
              "type": "string"
            },
            {
              "id": "id-4",
              "name": "requiredChanges",
              "value": "={{ $json.requiredChanges ?? $json.output?.requiredChanges }}",
              "type": "array"
            },
            {
              "id": "id-5",
              "name": "seoScore",
              "value": "={{ $json.seoScore }}",
              "type": "number"
            },
            {
              "id": "id-6",
              "name": "improvements",
              "value": "={{ $json.improvements }}",
              "type": "array"
            },
            {
              "id": "id-7",
              "name": "danishHeadline",
              "value": "={{ (() => {\n  const cur = $json.danishHeadline ?? $json.output?.danishHeadline;\n  if (cur) return cur;\n\n  try {\n    const j = $node[\"Article Fixer\"].json;\n    const v = j.danishHeadline ?? j.output?.danishHeadline;\n    if (v) return v;\n  } catch (e) {}\n\n  try {\n    const j = $node[\"Danish Article Writer\"].json;\n    const v = j.danishHeadline ?? j.output?.danishHeadline;\n    if (v) return v;\n  } catch (e) {}\n\n  return \"\";\n})() }}",
              "type": "string"
            },
            {
              "id": "id-8",
              "name": "danishArticle",
              "value": "={{ (() => {\n  const cur = $json.danishArticle ?? $json.output?.danishArticle;\n  if (cur) return cur;\n\n  try {\n    const j = $node[\"Article Fixer\"].json;\n    const v = j.danishArticle ?? j.output?.danishArticle;\n    if (v) return v;\n  } catch (e) {}\n\n  try {\n    const j = $node[\"Danish Article Writer\"].json;\n    const v = j.danishArticle ?? j.output?.danishArticle;\n    if (v) return v;\n  } catch (e) {}\n\n  return \"\";\n})() }}",
              "type": "string"
            },
            {
              "id": "id-9",
              "name": "metaDescription",
              "value": "={{ (() => {\n  const cur = $json.metaDescription ?? $json.output?.metaDescription;\n  if (cur) return cur;\n\n  try {\n    const j = $node[\"Article Fixer\"].json;\n    const v = j.metaDescription ?? j.output?.metaDescription;\n    if (v) return v;\n  } catch (e) {}\n\n  try {\n    const j = $node[\"Danish Article Writer\"].json;\n    const v = j.metaDescription ?? j.output?.metaDescription;\n    if (v) return v;\n  } catch (e) {}\n\n  return \"\";\n})() }}",
              "type": "string"
            },
            {
              "id": "id-10",
              "name": "tags",
              "value": "={{ (() => {\n  let t = $json.tags ?? $json.output?.tags;\n\n  if (t == null) {\n    try {\n      const j = $node[\"Article Fixer\"].json;\n      t = j.tags ?? j.output?.tags;\n    } catch (e) {}\n  }\n\n  if (t == null) {\n    try {\n      const j = $node[\"Danish Article Writer\"].json;\n      t = j.tags ?? j.output?.tags;\n    } catch (e) {}\n  }\n\n  if (Array.isArray(t)) return t.map(s => String(s).trim()).filter(Boolean);\n\n  if (typeof t === 'string') return t.split(',').map(s => s.trim()).filter(Boolean);\n\n  return [];\n})() }}",
              "type": "array"
            },
            {
              "id": "id-11",
              "name": "currentRevision",
              "value": "={{ $json.currentRevision ?? 0 }}",
              "type": "number"
            },
            {
              "id": "id-12",
              "name": "maxRevisions",
              "value": "={{ $json.maxRevisions }}",
              "type": "number"
            },
            {
              "id": "id-13",
              "name": "gameName",
              "value": "={{ $json.gameName }}",
              "type": "string"
            },
            {
              "id": "id-14",
              "name": "maxArticleLength",
              "value": "={{ $json.maxArticleLength }}",
              "type": "number"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "b4e9500a-5249-459f-a65b-394dfea4da71",
      "name": "Preserve Fields After QC",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1440,
        784
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "angle",
              "type": "string",
              "value": "={{ (() => { const angles = ['patch notes / opdatering','esport/turnering','event/collab','community/creative','rygter/læk','meta/balancing']; return angles[Math.floor(Math.random()*angles.length)]; })() }}"
            },
            {
              "id": "id-2",
              "name": "runId",
              "type": "string",
              "value": "={{ String(Date.now()) + '-' + Math.floor(Math.random()*1e6) }}"
            },
            {
              "id": "id-3",
              "name": "today",
              "type": "string",
              "value": "={{ $now.toISODate() }}"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "54f8861b-3067-451c-a99f-522a94b91fb9",
      "name": "Pick Random Angle",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -528,
        912
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Game Selection Form": {
      "main": [
        [
          {
            "node": "Workflow Configuration",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Workflow Configuration": {
      "main": [
        [
          {
            "node": "Pick Random Angle",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Model - Research": {
      "ai_languageModel": [
        [
          {
            "node": "Research Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Search Tool": {
      "ai_tool": [
        [
          {
            "node": "Research Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Research Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Research Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Research Agent": {
      "main": [
        [
          {
            "node": "Research Quality Check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Research Quality Check": {
      "main": [
        [
          {
            "node": "Image URL Validator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Image URL Validator": {
      "main": [
        [
          {
            "node": "Keyword Research Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Model - Keywords": {
      "ai_languageModel": [
        [
          {
            "node": "Keyword Research Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Keyword Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Keyword Research Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Keyword Research Agent": {
      "main": [
        [
          {
            "node": "Danish Article Writer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Model - Writer": {
      "ai_languageModel": [
        [
          {
            "node": "Danish Article Writer",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Article Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Danish Article Writer",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Model - SEO": {
      "ai_languageModel": [
        [
          {
            "node": "SEO Checker",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "SEO Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "SEO Checker",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Model - QC": {
      "ai_languageModel": [
        [
          {
            "node": "Quality Control Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "QC Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Quality Control Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Check Quality Approval": {
      "main": [
        [
          {
            "node": "Final Result",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Article Fixer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Model - Fixer": {
      "ai_languageModel": [
        [
          {
            "node": "Article Fixer",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Fixer Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Article Fixer",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Article Fixer": {
      "main": [
        [
          {
            "node": "Increment Revision Counter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Danish Article Writer": {
      "main": [
        [
          {
            "node": "Article Writer Validation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Article Writer Validation": {
      "main": [
        [
          {
            "node": "Check Article Valid",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Article Valid": {
      "main": [
        [
          {
            "node": "SEO Checker",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Article Fixer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Increment Revision Counter": {
      "main": [
        [
          {
            "node": "Check Revision Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Revision Limit": {
      "main": [
        [
          {
            "node": "Final Result",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "SEO Checker",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SEO Checker": {
      "main": [
        [
          {
            "node": "Preserve Fields After SEO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Preserve Fields After SEO": {
      "main": [
        [
          {
            "node": "Early Exit Check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Early Exit Check": {
      "main": [
        [
          {
            "node": "Check Early Exit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Early Exit": {
      "main": [
        [
          {
            "node": "Article Fixer",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Quality Control Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Quality Control Agent": {
      "main": [
        [
          {
            "node": "Preserve Fields After QC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Preserve Fields After QC": {
      "main": [
        [
          {
            "node": "Check Quality Approval",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pick Random Angle": {
      "main": [
        [
          {
            "node": "Research Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Final Result": {
      "main": [
        [
          {
            "node": "Send Article Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "ff4cd900-da91-49fb-b7bb-ff70cb9d4392",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "ec980270f9962c83a2c6200d0a8ddfc6adffb52117c90083529e0094cbf89053"
  },
  "id": "IFmUP8L9OKWpMih6",
  "tags": []
}